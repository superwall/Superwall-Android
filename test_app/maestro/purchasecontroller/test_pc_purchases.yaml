appId: com.superwall.superapp
---
- runFlow:
    file: "../login.yaml"
    optional: true
# Launch app and navigate to Purchase Controller Test
- launchApp: com.superwall.superapp
- tapOn: "Purchase Controller Test"
- tapOn: "Mock PC Test"

# Configure with Purchase Controller (purchases initially disabled)
- tapOn: "Configure with PC"
# We mark this as optional as sometimes it triggers but doesnt register as visible
- tapOn: 
    text: "Trigger Paywall"
    waitToSettleTimeoutMs: 1000
    optional: true
- waitForAnimationToEnd:
      timeout: 1000
# Test paywall with purchases disabled (should show error)
- tapOn:
      text: "Continue"
      waitToSettleTimeoutMs: 1000
- assertVisible: "An error occurred"
- tapOn:
    text: "DONE"
    waitToSettleTimeoutMs: 1000

- runFlow:
    file: "../util/back.yaml"

- tapOn: "OK"
# Enable purchases and test successful purchase flow
- tapOn: "Enable purchases"
- tapOn: 
    text: "Trigger Paywall"
    waitToSettleTimeoutMs: 1000
    optional: true
- waitForAnimationToEnd:
      timeout: 1000
# Verify successful purchase and feature access
- tapOn:
      text: "Continue"
      waitToSettleTimeoutMs: 1000
- assertVisible: 
    text: "Subscribed"
    optional: true
- assertVisible: "Feature triggered"
- tapOn: "OK"

# Reset and prepare for another test
- tapOn: "Reset status"
- tapOn: "Trigger Paywall"
- waitForAnimationToEnd:
      timeout: 1000


